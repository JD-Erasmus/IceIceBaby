@model IEnumerable<IceIceBaby.Models.DeliveryRun>
@{
    ViewData["Title"] = "Delivery Runs";
}

<section class="mb-4 d-flex flex-column flex-md-row justify-content-between align-items-md-center gap-3">
    <div>
        <h1 class="page-title mb-1">Delivery runs</h1>
        <p class="text-muted mb-0">Keep track of the routes that keep customers stocked.</p>
    </div>
    <a class="btn btn-primary" asp-controller="DeliveryRuns" asp-action="Create">Create Run</a>
</section>

<section class="card border-0 shadow-soft p-4">
    <h5 class="mb-3">Runs</h5>
    <div class="table-responsive">
        <table class="table table-striped align-middle mb-0">
            <thead>
                <tr>
                    <th>Run #</th>
                    <th>Date</th>
                    <th>Driver</th>
                    <th>Vehicle</th>
                    <th>Status</th>
                    <th class="text-end">Stops</th>
                    <th class="text-end">Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var r in Model.OrderByDescending(r => r.Status == IceIceBaby.Models.DeliveryRunStatus.InProgress)
                                           .ThenByDescending(r => r.Status == IceIceBaby.Models.DeliveryRunStatus.New)
                                           .ThenByDescending(r => r.RunDate))
                {
                    <tr>
                        <td>@r.Id</td>
                        <td>@r.RunDate.ToString("yyyy-MM-dd")</td>
                        <td>@r.DriverName</td>
                        <td>@r.Vehicle</td>
                        <td>@r.Status</td>
                        <td class="text-end">@r.Stops?.Count()</td>
                        <td class="text-end">
                            <a class="btn btn-sm btn-outline-primary" asp-action="Details" asp-route-id="@r.Id">View</a>
                            @if (r.Status == IceIceBaby.Models.DeliveryRunStatus.New)
                            {
                                <form asp-action="Start" method="post" class="d-inline">
                                    <input type="hidden" name="id" value="@r.Id" />
                                    <button type="submit" class="btn btn-sm btn-success">Start</button>
                                </form>
                            }
                            else if (r.Status == IceIceBaby.Models.DeliveryRunStatus.InProgress)
                            {
                                <form asp-action="Complete" method="post" class="d-inline">
                                    <input type="hidden" name="id" value="@r.Id" />
                                    <button type="submit" class="btn btn-sm btn-secondary">Complete</button>
                                </form>
                            }
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</section>
